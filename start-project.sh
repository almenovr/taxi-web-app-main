#!/bin/bash

echo "üöó –ó–∞–ø—É—Å–∫ –¢–∞–∫—Å–∏ –°–µ—Ä–≤–∏—Å–∞ –ö—Ä—ã–º–∞"
echo ""

echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å–µ—Ä–≤–µ—Ä–∞..."
cd server-side
npm install
if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å–µ—Ä–≤–µ—Ä–∞"
    exit 1
fi
echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∫–ª–∏–µ–Ω—Ç–∞..."
cd ../client-side
npm install
if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∫–ª–∏–µ–Ω—Ç–∞"
    exit 1
fi
echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

echo "üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ Strapi..."
cd ../server-side
npm run develop &
STRAPI_PID=$!

echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞..."
sleep 10

echo "üåê –û—Ç–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω–∫—É Strapi..."
if command -v xdg-open &> /dev/null; then
    xdg-open http://localhost:1337/admin
elif command -v open &> /dev/null; then
    open http://localhost:1337/admin
else
    echo "üì± –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ: http://localhost:1337/admin"
fi

echo ""
echo "üí° –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:"
echo "1. –í –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∞–¥–º–∏–Ω–∫–∞ Strapi"
echo "2. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"
echo "3. –ó–∞–ø–æ–º–Ω–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å"
echo "4. –ò–∑–º–µ–Ω–∏—Ç–µ –∏—Ö –≤ —Ñ–∞–π–ª–∞—Ö scripts/setup-content-types.js –∏ scripts/create-demo-data.js"
echo "5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"
echo ""

echo "üöÄ –ó–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏..."
cd ../client-side
npm run dev &
CLIENT_PID=$!

echo ""
echo "‚úÖ –ü—Ä–æ–µ–∫—Ç –∑–∞–ø—É—â–µ–Ω!"
echo "üì± –ö–ª–∏–µ–Ω—Ç: http://localhost:3000"
echo "üõ†Ô∏è –ê–¥–º–∏–Ω–∫–∞: http://localhost:1337/admin"
echo "üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: README.md"
echo ""
echo "–ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
cleanup() {
    echo ""
    echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."
    kill $STRAPI_PID 2>/dev/null
    kill $CLIENT_PID 2>/dev/null
    exit 0
}

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∏–≥–Ω–∞–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
trap cleanup SIGINT SIGTERM

# –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
wait